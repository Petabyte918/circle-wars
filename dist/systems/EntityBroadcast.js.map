{"version":3,"sources":["../../server/systems/EntityBroadcast.js"],"names":["EntityBroadcastSystem","io","_entities","entities","e","components","dynamic","dirty","deleted","emit","entityId","console","log"],"mappings":";;;;;;;;;AAAA;;;;IACaA,qB,WAAAA,qB;AAET,mCAAYC,EAAZ,EAAgB;AAAA;;AACZ,aAAKA,EAAL,GAAUA,EAAV;AACH;;;;6BACIC,S,EAAW;AACZ,gBAAMC,WAAW,sBAAKD,SAAL,EAAgB;AAAA,uBAAME,EAAEC,UAAF,CAAaC,OAAb,IAAwBF,EAAEC,UAAF,CAAaC,OAAb,CAAqBC,KAArB,KAA+B,IAAxD,IAAiEH,EAAEC,UAAF,CAAaG,OAAnF;AAAA,aAAhB,CAAjB;AACA,iBAAKP,EAAL,CAAQQ,IAAR,CAAa,UAAb,EAAyBN,QAAzB;AACA,iBAAK,IAAIO,QAAT,IAAqBP,QAArB,EAA+B;AAC3B,oBAAIA,SAASO,QAAT,EAAmBL,UAAnB,CAA8BC,OAAlC,EACIH,SAASO,QAAT,EAAmBL,UAAnB,CAA8BC,OAA9B,CAAsCC,KAAtC,GAA8C,KAA9C;AACJ,oBAAIJ,SAASO,QAAT,EAAmBL,UAAnB,CAA8BG,OAAlC,EAA2C;AACvCG,4BAAQC,GAAR,CAAY,UAAZ,EAAwBF,QAAxB;AACA,2BAAOR,UAAUQ,QAAV,CAAP;AACH;AACJ;AACJ","file":"EntityBroadcast.js","sourcesContent":["import {pick} from 'underscore'\r\nexport class EntityBroadcastSystem {\r\n    io\r\n    constructor(io) {\r\n        this.io = io\r\n    }\r\n    step(_entities) {\r\n        const entities = pick(_entities, e => (e.components.dynamic && e.components.dynamic.dirty === true) || e.components.deleted)\r\n        this.io.emit('entities', entities)\r\n        for (let entityId in entities) {\r\n            if (entities[entityId].components.dynamic)\r\n                entities[entityId].components.dynamic.dirty = false\r\n            if (entities[entityId].components.deleted) {\r\n                console.log('deleting', entityId)\r\n                delete _entities[entityId]\r\n            }\r\n        }\r\n    }\r\n}"]}